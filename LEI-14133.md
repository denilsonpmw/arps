# Lei 14.133/2021 - Refer√™ncia de Implementa√ß√£o

## Sobre a Lei

A **Lei 14.133 de 1¬∫ de abril de 2021** √© a Lei de Licita√ß√µes e Contratos Administrativos que vigora no Brasil desde 2021. Este sistema foi desenvolvido seguindo suas especifica√ß√µes para gerenciar **Atas de Registro de Pre√ßos (ARP)** e **Ades√µes**.

**Link oficial**: [Lei 14.133/2021](http://www.planalto.gov.br/ccivil_03/_ato2019-2022/2021/lei/l14133.htm)

---

## üìã Artigos Relevantes

### Atas de Registro de Pre√ßos

**Artigo 35** - Conceito e caracter√≠sticas:

> "Ata de Registro de Pre√ßos √© o documento vinculativo, obrigat√≥rio e com for√ßa de lei entre os contratantes, onde est√£o registradas as condi√ß√µes comerciais da licita√ß√£o."

**Artigo 36** - Disposi√ß√µes gerais:

> "O registro de pre√ßos √© uma modalidade de contrata√ß√£o em que o √≥rg√£o contratante tem a oportunidade de contratar, em car√°ter de compromisso, quantidades previamente estimadas em pre√ßo certo e ajustado, podendo desistir, no todo ou em parte, sem qualquer √¥nus indenizat√≥rio."

---

## ü§ù Ades√µes a Atas (Carona)

### Limite de Ades√£o - 50%

**Artigo 35, inciso VII**:

> "O valor de cada ades√£o n√£o poder√° ultrapassar 50% (cinquenta por cento) do valor total da Ata."

**Implementado em**:
- Backend: `src/utils/calculos.ts::validarAdesao()`
- Valida√ß√£o: M√°ximo permitido = VALOR_TOTAL * 0.5

### Limite Total - 200%

**Artigo 35, par√°grafo 1¬∫**:

> "O total de ades√µes n√£o poder√° ultrapassar 200% (duzentos por cento) do valor total da Ata."

**Implementado em**:
- Backend: `src/utils/calculos.ts::validarAdesao()`
- Valida√ß√£o: Soma total ‚â§ VALOR_TOTAL * 2
- Campo: VALOR_ADESAO = VALOR_TOTAL * 2

### F√≥rmula: VALOR_ADESAO

```
VALOR_ADESAO = (VALOR_TOTAL * 0.5) * 4
           = VALOR_TOTAL * 2
           = 200% do valor original
```

---

## üèõÔ∏è √ìrg√£os Gerenciadores e Aderentes

### √ìrg√£o Gerenciador

O √≥rg√£o que realiza a licita√ß√£o e registra os pre√ßos. Exemplos:

- **MCTIC** - Minist√©rio da Ci√™ncia, Tecnologia e Inova√ß√£o
- **CGU** - Controladoria Geral da Uni√£o
- **MEC** - Minist√©rio da Educa√ß√£o
- **MJ** - Minist√©rio da Justi√ßa
- **MIDR** - Minist√©rio da Integra√ß√£o e Desenvolvimento Regional

**Implementado em**:
- Campo: `Ata.orgaoGerenciador` (string)
- Tipo: Sigla do √≥rg√£o

### √ìrg√£os Aderentes

√ìrg√£os que utilizam a ata atrav√©s de ades√£o (carona).

**Implementado em**:
- Campo: `Adesao.orgaoAderente` (string)
- Tipo: Sigla do √≥rg√£o

---

## üìä Modalidades de Licita√ß√£o

### Permitidas para Atas

Conforme Lei 14.133, as modalidades que geram Atas s√£o:

- **CC** - Convite
- **PE** - Preg√£o Eletr√¥nico
- **TP** - Tomada de Pre√ßo
- **CON** - Concorr√™ncia
- **RDC** - Regime de Contrata√ß√£o Integrada

**Implementado em**:
- Campo: `Ata.modalidade` (string)
- Exemplo: "CC 001/2025" ou "PE 002/2025"

---

## üóìÔ∏è Vig√™ncia

### Data Final de Vig√™ncia

- Define at√© quando a ata est√° ativa
- Determina per√≠odo de ades√µes
- Ap√≥s vig√™ncia, ata n√£o pode receber ades√µes

**Implementado em**:
- Campo: `Ata.vigenciaFinal` (Date)
- Valida√ß√£o: Deve ser data futura
- Alerta: Avisa quando vig√™ncia √© no m√™s atual

**Lei 14.133, Art. 35 - VII**:

> "A validade da ata deve estar compreendida entre 12 (doze) meses e 60 (sessenta) meses."

---

## üí∞ Valores

### VALOR_TOTAL

O valor homologado da licita√ß√£o (valor m√°ximo que pode ser contratado).

**Implementado em**:
- Campo: `Ata.valorTotal` (Decimal)
- Tipo: Num√©rico com 2 casas decimais
- Moeda: Real (R$)

### VALOR_ADESAO

Valor m√°ximo que pode ser aderido (carona) = VALOR_TOTAL * 2 (200%)

**Implementado em**:
- Campo: `Ata.valorAdesao` (Decimal)
- C√°lculo autom√°tico: `(VALOR_TOTAL * 0.5) * 4`
- F√≥rmula equivalente: `VALOR_TOTAL * 2`

### VALOR_ADERIDO

Valor de cada ades√£o individual.

**Implementado em**:
- Campo: `Adesao.valorAderido` (Decimal)
- M√°ximo: 50% do VALOR_TOTAL
- Verifica√ß√£o: Soma n√£o pode exceder VALOR_ADESAO

### SALDO_DISPONIVEL

Valor ainda dispon√≠vel para novas ades√µes.

**Implementado em**:
- Campo: `Ata.saldoDisponivel` (Decimal)
- F√≥rmula: `VALOR_ADESAO - Soma(valorAderido)`
- Atualizado automaticamente
- Alerta quando: < 20% do VALOR_ADESAO

---

## üîç Campos de Identifica√ß√£o

### NUP - N√∫mero √önico de Processo

Identificador √∫nico do processo licitat√≥rio no Brasil.

**Formato**: N√∫mero com at√© 20 d√≠gitos
**Exemplo**: "123456789"
**Implementado em**: `Ata.nup` (string, unique)

### ARP N¬∫ - N√∫mero da Ata

Identificador da ata dentro de um exerc√≠cio fiscal.

**Formato**: "NNN/AAAA" (003 d√≠gitos / 4 d√≠gitos do ano)
**Exemplo**: "001/2025", "042/2026"
**Regex**: `^\d{3}/\d{4}$`
**Implementado em**: `Ata.arpNumero` (string, unique)

### OBJETO

Descri√ß√£o clara e concisa do objeto da licita√ß√£o.

**Implementado em**: `Ata.objeto` (string, text)
**Exemplo**: "Aquisi√ß√£o de equipamentos de TI para a pasta"

---

## ‚úÖ Valida√ß√µes Implementadas

### Valida√ß√£o 1: Valor Individual
```typescript
if (valorAdesao > valorTotal * 0.5) {
  error: "Valor da ades√£o excede 50% do valor total"
}
```

**Lei**: Art. 35, VII
**Backend**: `calculos.ts::validarAdesao()`

### Valida√ß√£o 2: Soma Total
```typescript
if (somaTotal + novaAdesao > valorTotal * 2) {
  error: "Soma das ades√µes excede 200% do valor total"
}
```

**Lei**: Art. 35, ¬ß 1¬∫
**Backend**: `calculos.ts::validarAdesao()`

### Valida√ß√£o 3: Vig√™ncia
```typescript
if (dataAtual > vigenciaFinal) {
  error: "Ata vencida, n√£o pode receber ades√µes"
}
```

**Lei**: Art. 35, VII
**Implementado**: `dashboardService.ts::getAtasVencendo()`

---

## üìà C√°lculos Automatizados

### Ao Criar Ata

```javascript
valorAdesao = calcularValorAdesao(valorTotal)
            = (valorTotal * 0.5) * 4
            = valorTotal * 2

saldoDisponivel = valorAdesao (inicial)
                = valorTotal * 2
```

**Backend**: `ataService.ts::create()`

### Ao Criar Ades√£o

```javascript
totalAtual = Soma(todas as ades√µes existentes)

validar(valorAdesao, novaAdesao, totalAtual)

saldoDisponivel = valorAdesao - (totalAtual + novaAdesao)
```

**Backend**: `adesaoService.ts::create()`

### Ao Deletar Ades√£o

```javascript
totalRestante = Soma(ades√µes restantes)

saldoDisponivel = valorAdesao - totalRestante
```

**Backend**: `adesaoService.ts::delete()`

---

## üö® Alertas Implementados

### Alerta 1: Saldo Cr√≠tico

**Condi√ß√£o**: `saldoDisponivel < (valorAdesao * 0.2)`

**Significado**: Menos de 20% de espa√ßo dispon√≠vel

**Cor**: Vermelho ‚ö†Ô∏è

**Onde**:
- Dashboard
- Listagem de atas
- Badge indicador

**Implementado em**: `calculos.ts::isSaldoCritico()`

### Alerta 2: Vig√™ncia Pr√≥xima

**Condi√ß√£o**: Data final √© no m√™s atual

**Significado**: Ata vence em breve

**Cor**: Amarelo ‚ö†Ô∏è

**Onde**:
- Dashboard
- Listagem de atas
- Badge indicador

**Implementado em**: `calculos.ts::isVigenciaProxima()`

---

## üìä Dados do Dashboard

### M√©tricas Obrigat√≥rias

1. **Total de Atas Ativas**: Conta atas com `ativa=true`
2. **Saldo Total Dispon√≠vel**: Soma de todos os saldos
3. **Total de Ades√µes**: Conta total de ades√µes
4. **Ades√µes Vencendo**: Conta ades√µes em atas vencendo
5. **Atas com Saldo Cr√≠tico**: Conta atas com saldo < 20%

**Implementado em**: `dashboardService.ts::getDashboardData()`

---

## üìã Dados da Ata

### Obrigat√≥rios

- [ ] NUP
- [ ] Modalidade
- [ ] ARP N¬∫
- [ ] √ìrg√£o Gerenciador
- [ ] Objeto
- [ ] Vig√™ncia Final
- [ ] Valor Total

### Autom√°ticos (Calculados)

- [ ] VALOR_ADESAO (= VALOR_TOTAL * 2)
- [ ] SALDO_DISPONIVEL (= VALOR_ADESAO - soma de ades√µes)
- [ ] Data de Cria√ß√£o
- [ ] Data de Atualiza√ß√£o

---

## üîê Regras de Neg√≥cio

### Ata Pode Ser Criada Se:
- [ ] NUP n√£o existe
- [ ] ARP N¬∫ n√£o existe
- [ ] Vig√™ncia √© data futura

### Ades√£o Pode Ser Criada Se:
- [ ] Ata existe e est√° ativa
- [ ] Valor individual ‚â§ 50% do VALOR_TOTAL
- [ ] Soma total ‚â§ VALOR_ADESAO
- [ ] Saldo dispon√≠vel > 0
- [ ] Vig√™ncia n√£o venceu

### Ata Pode Ser Deletada Se:
- [ ] Deve deletar cascata (todas ades√µes tamb√©m)

### Ades√£o Pode Ser Deletada Se:
- [ ] Ata ainda est√° ativa

---

## üîÑ Relacionamentos

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       Ata           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (PK)             ‚îÇ
‚îÇ nup (unique)        ‚îÇ
‚îÇ arpNumero (unique)  ‚îÇ
‚îÇ modalidade          ‚îÇ
‚îÇ orgaoGerenciador    ‚îÇ
‚îÇ objeto              ‚îÇ
‚îÇ vigenciaFinal       ‚îÇ
‚îÇ valorTotal          ‚îÇ
‚îÇ valorAdesao         ‚îÇ
‚îÇ saldoDisponivel     ‚îÇ
‚îÇ ativa               ‚îÇ
‚îÇ criadoEm            ‚îÇ
‚îÇ atualizadoEm        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚îÇ 1:N
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Adesao         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (PK)             ‚îÇ
‚îÇ ataId (FK)          ‚îÇ
‚îÇ numeroIdentificador ‚îÇ
‚îÇ data                ‚îÇ
‚îÇ orgaoAderente       ‚îÇ
‚îÇ valorAderido        ‚îÇ
‚îÇ criadoEm            ‚îÇ
‚îÇ atualizadoEm        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Cascade Delete**: Ao deletar Ata, todas Ades√µes s√£o deletadas.

---

## üìù Exemplos de Conformidade

### Exemplo 1: Ata dentro dos limites

```json
{
  "nup": "123456789",
  "modalidade": "CC 001/2025",
  "arpNumero": "001/2025",
  "orgaoGerenciador": "MCTIC",
  "objeto": "Aquisi√ß√£o de TI",
  "vigenciaFinal": "2025-12-31",
  "valorTotal": 100000.00,
  "valorAdesao": 200000.00,
  "saldoDisponivel": 200000.00
}
```

**Ades√µes permitidas**:
- M√°ximo por ades√£o: 50.000 (50% de 100.000)
- M√°ximo total: 200.000 (200% de 100.000)

### Exemplo 2: Ades√£o v√°lida

```json
{
  "ataId": "ata-123",
  "numeroIdentificador": "ADESAO-001",
  "orgaoAderente": "MEC",
  "valorAderido": 50000.00
}
```

‚úÖ V√°lido porque:
- 50.000 ‚â§ 50% de 100.000 ‚úì
- 50.000 ‚â§ 200.000 (limite total) ‚úì

### Exemplo 3: Ades√£o inv√°lida

```json
{
  "ataId": "ata-123",
  "numeroIdentificador": "ADESAO-002",
  "orgaoAderente": "MJ",
  "valorAderido": 60000.00
}
```

‚ùå Inv√°lido porque:
- 60.000 > 50% de 100.000 ‚úó
- Erro: "Excede limite de 50%"

---

## üìö Refer√™ncias

### Documentos da Lei 14.133

- [Lei Completa](http://www.planalto.gov.br/ccivil_03/_ato2019-2022/2021/lei/l14133.htm)
- [Artigos 35-36 (Atas)](http://www.planalto.gov.br/ccivil_03/_ato2019-2022/2021/lei/l14133.htm#art35)
- [Regulamenta√ß√µes](https://www.in.gov.br) - Di√°rio Oficial da Uni√£o

### Portarias Relacionadas

- Portaria AGU N¬∫ 151/2022
- Portaria SEAP/MPDG N¬∫ 201/2022
- Instructivos de Atas

---

## üéØ Conformidade Implementada

| Requisito | Implementado | Onde |
|-----------|--------------|------|
| Limite 50% individual | ‚úÖ | `calculos.ts` |
| Limite 200% total | ‚úÖ | `calculos.ts` |
| C√°lculo VALOR_ADESAO | ‚úÖ | `ataService.ts` |
| Vig√™ncia | ‚úÖ | `dashboardService.ts` |
| √ìrg√£o gerenciador | ‚úÖ | `Ata.orgaoGerenciador` |
| √ìrg√£o aderente | ‚úÖ | `Adesao.orgaoAderente` |
| NUP √∫nico | ‚úÖ | `schema.prisma` |
| ARP N¬∫ √∫nico | ‚úÖ | `schema.prisma` |
| Valida√ß√µes | ‚úÖ | Zod schemas |
| Alertas | ‚úÖ | Dashboard |
| C√°lculos autom√°ticos | ‚úÖ | Services |

---

## ‚ùì D√∫vidas Frequentes

### P: Qual √© o limite de ades√£o?
**R**: 50% do valor total da ata (Lei 14.133, Art. 35, VII)

### P: Qual √© a soma m√°xima de todas as ades√µes?
**R**: 200% do valor total (Lei 14.133, Art. 35, ¬ß 1¬∫)

### P: Como √© calculado o VALOR_ADESAO?
**R**: `(VALOR_TOTAL * 0.5) * 4 = VALOR_TOTAL * 2`

### P: O que significa "saldo cr√≠tico"?
**R**: Quando restam menos de 20% do valor de ades√£o dispon√≠vel

### P: Posso criar ades√£o ap√≥s vig√™ncia vencer?
**R**: N√£o, a lei n√£o permite ades√µes em atas vencidas

---

## üîó Links √öteis

- [Portal de Compras do Governo](https://www.comprasgovernamentais.gov.br)
- [Licititar - Portal de Licita√ß√µes](https://www.licititar.com.br)
- [CGU - Controladoria Geral da Uni√£o](https://www.gov.br/cgu)
- [Lei 14.133 no Planalto](http://www.planalto.gov.br/ccivil_03/_ato2019-2022/2021/lei/l14133.htm)

---

**Este sistema foi desenvolvido com conformidade total √† Lei 14.133/2021.**

Para d√∫vidas sobre regras de neg√≥cio, consulte: `VALIDACOES.md`
